<!-- Template actualizado del dashboard principal -->

<!-- Header superior -->
<div class="dashboard-header">
  <div class="dashboard-controls">
    <button mat-icon-button (click)="toggleAmountVisibility()"
      [matTooltip]="hideAmounts() ? 'Mostrar montos' : 'Ocultar montos'" class="visibility-btn" [disabled]="loading()">
      <mat-icon>{{ hideAmounts() ? 'visibility' : 'visibility_off' }}</mat-icon>
    </button>

    <div class="refresh-section">
      <span class="text-muted">Ãšltima actualizaciÃ³n: {{ lastUpdated() | date:'M/d/yy, h:mm a' }}</span>
      <button mat-icon-button (click)="refreshData()" matTooltip="Actualizar datos" [disabled]="loading()">
        <mat-icon [class.spinning]="loading()">refresh</mat-icon>
      </button>
    </div>
  </div>
</div>

<div class="dashboard-layout">
  <!-- Columna izquierda - GrÃ¡fico evoluciÃ³n + Billetera/Torta -->
  <div class="wallet-section">
    <!-- GrÃ¡fico de evoluciÃ³n - PRIMERA COLUMNA -->
    <app-wallet-evolution-chart [chartData]="walletHistoryData()" [hideAmounts]="hideAmounts()" [isLoading]="loading()"
      [refreshTrigger]="refreshTrigger()" class="evolution-chart">
    </app-wallet-evolution-chart>

    <!-- Total de billetera + GrÃ¡fico categorÃ­as - SEGUNDA COLUMNA -->
    <div class="wallet-summary-column">
      <mat-card class="total-card">
        @if (loading()) {
        <!-- Estado de carga -->
        <div class="skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-amount"></div>
          <div class="skeleton-chart"></div>
        </div>
        } @else if (error()) {
        <!-- Estado de error -->
        <div class="error-content">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h3>Error al cargar datos</h3>
          <p>{{ error() }}</p>
          <button mat-raised-button color="primary" (click)="refreshData()">
            <mat-icon>refresh</mat-icon>
            Reintentar
          </button>
        </div>
        } @else {
        <!-- Contenido normal -->
        <div class="summary-content">
          <!-- TÃ­tulo de la card arriba del monto -->
          <div class="card-title">
            <span class="summary-title">ðŸ’° TOTAL BILLETERA</span>
          </div>

          <!-- Total Amount centrado -->
          <div class="total-amount-container">
            <div class="total-amount" [class.hidden-amount]="hideAmounts()">
              {{ hideAmounts() ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : (totalWallet() | currencyFormat:'USD') }}
            </div>
          </div>

          <!-- GrÃ¡fico de categorÃ­as centrado -->
          @if (categories() && categories().length > 0) {
          <div class="categories-chart-section">
            <app-wallet-categories-chart [categories]="categories()" [hideAmounts]="hideAmounts()">
            </app-wallet-categories-chart>
          </div>
          }
        </div>
        }
      </mat-card>
    </div>
  </div>

  <!-- Columna derecha - Cards de rendimiento -->
  <div class="performance-section">
    <div class="performance-cards">
      <!-- Rendimiento Total -->
      <mat-card class="performance-card total-performance">
        @if (loading()) {
        <div class="skeleton-performance">
          <div class="skeleton-performance-header">
            <div class="skeleton-performance-title"></div>
            <div class="skeleton-performance-percentage"></div>
          </div>
          <div class="skeleton-performance-amount"></div>
        </div>
        } @else if (error()) {
        <div class="error-performance">
          <mat-icon class="error-icon-small">error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>
        } @else {
        <div class="performance-header">
          <span>ðŸ’°</span>
          <span class="performance-title-total">RENDIMIENTO TOTAL</span>
          <div class="performance-indicators">
            <span class="performance-percentage" [ngClass]="totalPerformanceClass()">
              {{ totalPercentageGain() >= 0 ? '+' : '' }}{{ totalPercentageGain() }}%
            </span>
          </div>
        </div>
        <div class="performance-amount" [ngClass]="totalPerformanceClass()">
          <span [class.hidden-amount]="hideAmounts()">
            @if (hideAmounts()) {
            â€¢â€¢â€¢â€¢â€¢â€¢
            } @else {
            {{ totalPercentageGain() >= 0 ? '+' : '' }}{{ totalDifference() | currencyFormat:'USD' }}
            }
          </span>
          <mat-icon class="trend-icon" [ngClass]="totalPerformanceClass()">
            {{ totalPercentageGain() >= 0 ? 'trending_up' : 'trending_down' }}
          </mat-icon>
        </div>
        }
      </mat-card>

      <!-- Rendimiento DÃ³lares -->
      <mat-card class="performance-card dollars-performance">
        @if (loading()) {
        <div class="skeleton-performance">
          <div class="skeleton-performance-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-performance-title"></div>
            <div class="skeleton-performance-percentage"></div>
          </div>
          <div class="skeleton-performance-amount"></div>
        </div>
        } @else if (error()) {
        <div class="error-performance">
          <mat-icon class="error-icon-small">error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>
        } @else {
        <div class="performance-header">
          <mat-icon class="performance-icon">attach_money</mat-icon>
          <span class="performance-title">RENDIMIENTO DÃ“LARES</span>
          <div class="performance-indicators">
            <span class="performance-percentage" [ngClass]="dollarPerformanceClass()">
              {{ dollarPercentageGain() >= 0 ? '+' : '' }}{{ dollarPercentageGain() }}%
            </span>
          </div>
        </div>
        <div class="performance-amount" [ngClass]="dollarPerformanceClass()">
          <span [class.hidden-amount]="hideAmounts()">
            @if (hideAmounts()) {
            â€¢â€¢â€¢â€¢â€¢â€¢
            } @else {
            {{ dollarPercentageGain() >= 0 ? '+' : '' }}{{ dollarDifference() | currencyFormat:'USD' }}
            }
          </span>
          <mat-icon class="trend-icon" [ngClass]="dollarPerformanceClass()">
            {{ dollarPercentageGain() >= 0 ? 'trending_up' : 'trending_down' }}
          </mat-icon>
        </div>
        }
      </mat-card>

      <!-- Rendimiento Acciones -->
      <mat-card class="performance-card stocks-performance">
        @if (loading()) {
        <div class="skeleton-performance">
          <div class="skeleton-performance-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-performance-title"></div>
            <div class="skeleton-performance-percentage"></div>
          </div>
          <div class="skeleton-performance-amount"></div>
        </div>
        } @else if (error()) {
        <div class="error-performance">
          <mat-icon class="error-icon-small">error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>
        } @else {
        <div class="performance-header">
          <mat-icon class="performance-icon">bar_chart</mat-icon>
          <span class="performance-title">RENDIMIENTO ACCIONES</span>
          <div class="performance-indicators">
            <span class="performance-percentage" [ngClass]="stockPerformanceClass()">
              {{ stockPercentageGain() >= 0 ? '+' : '' }}{{ stockPercentageGain() }}%
            </span>
          </div>
        </div>
        <div class="performance-amount" [ngClass]="stockPerformanceClass()">
          <span [class.hidden-amount]="hideAmounts()">
            @if (hideAmounts()) {
            â€¢â€¢â€¢â€¢â€¢â€¢
            } @else {
            {{ stockPercentageGain() >= 0 ? '+' : '' }}{{ stockDifference() | currencyFormat:'USD' }}
            }
          </span>
          <mat-icon class="trend-icon" [ngClass]="stockPerformanceClass()">
            {{ stockPercentageGain() >= 0 ? 'trending_up' : 'trending_down' }}
          </mat-icon>
        </div>
        }
      </mat-card>

      <!-- Rendimiento Criptomonedas -->
      <mat-card class="performance-card crypto-performance">
        @if (loading()) {
        <div class="skeleton-performance">
          <div class="skeleton-performance-header">
            <div class="skeleton-icon"></div>
            <div class="skeleton-performance-title"></div>
            <div class="skeleton-performance-percentage"></div>
          </div>
          <div class="skeleton-performance-amount"></div>
        </div>
        } @else if (error()) {
        <div class="error-performance">
          <mat-icon class="error-icon-small">error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>
        } @else {
        <div class="performance-header">
          <mat-icon class="performance-icon">currency_bitcoin</mat-icon>
          <span class="performance-title">RENDIMIENTO CRYPTOMONEDAS</span>
          <div class="performance-indicators">
            <span class="performance-percentage" [ngClass]="cryptoPerformanceClass()">
              {{ cryptoPercentageGain() >= 0 ? '+' : '' }}{{ cryptoPercentageGain() }}%
            </span>
          </div>
        </div>
        <div class="performance-amount" [ngClass]="cryptoPerformanceClass()">
          <span [class.hidden-amount]="hideAmounts()">
            @if (hideAmounts()) {
            â€¢â€¢â€¢â€¢â€¢â€¢
            } @else {
            {{ cryptoPercentageGain() >= 0 ? '+' : '' }}{{ cryptoDifference() | currencyFormat:'USD' }}
            }
          </span>
          <mat-icon class="trend-icon" [ngClass]="cryptoPerformanceClass()">
            {{ cryptoPercentageGain() >= 0 ? 'trending_up' : 'trending_down' }}
          </mat-icon>
        </div>
        }
      </mat-card>
    </div>
  </div>
</div>